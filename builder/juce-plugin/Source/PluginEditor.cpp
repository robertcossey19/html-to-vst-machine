#include "PluginEditor.h"
#include "BinaryData.h" // <- generated by juce_add_binary_data(HtmlUIData)

//==============================================================================

HtmlToVstAudioProcessorEditor::HtmlToVstAudioProcessorEditor (HtmlToVstAudioProcessor& p)
    : AudioProcessorEditor (&p), processor (p)
{
    setOpaque (true);
    setSize (1000, 600); // room for the HTML UI

    // JUCE 8 WebBrowserComponent: use Options-based ctor
    juce::WebBrowserComponent::Options options;
    webView = std::make_unique<juce::WebBrowserComponent> (options);

    addAndMakeVisible (*webView);

   #if JUCE_MAC
    webView->setOpaque (false);
   #endif

    // -------------------------------------------------------------------------
    // Load embedded HTML UI from BinaryData (ampex_ui.html)
    // -------------------------------------------------------------------------

    juce::String html = juce::String::fromUTF8 (BinaryData::ampex_ui_html,
                                                BinaryData::ampex_ui_htmlSize);

    // IMPORTANT:
    // We DO NOT URL-escape this string here. The previous versions that showed
    // a white box full of `%3C!DOCTYPE` were effectively feeding a URL-encoded
    // blob to a host that then showed it as plain text.
    //
    // JUCE's WebBrowserComponent on modern macOS wants a data: URL for inline
    // content when not using goToString(). We'll give it the raw HTML. If some
    // hosts are picky, we can switch back to goToString() in a later pass.
    //
    juce::String dataUri = "data:text/html;charset=utf-8," + html;

    webView->goToURL (dataUri);
}

HtmlToVstAudioProcessorEditor::~HtmlToVstAudioProcessorEditor() = default;

//==============================================================================

void HtmlToVstAudioProcessorEditor::paint (juce::Graphics& g)
{
    // Background in case the webview doesn't fill everything briefly.
    g.fillAll (juce::Colours::black);
}

void HtmlToVstAudioProcessorEditor::resized()
{
    if (webView != nullptr)
        webView->setBounds (getLocalBounds());
}
